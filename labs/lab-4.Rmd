---
title: "Lab 4: Probability Distributions"
output: 
  html_document: 
    theme: cosmo
    toc: yes
    toc_depth: 3
    toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# suppress scientific notation
options(scipen = 999)

# load packages
library(tidyverse)
library(magrittr)
library(psych)
library(gganimate)
```

# Purpose

Today we will be exploring the world of probability distributions. The content of the lab will be split into two sections: The first half will discuss binomial and multinomial distributions. The second half will discuss normal distributions. At the end, we will briefly discuss other types of distributions. The Minihacks will ask you to put to test

Today's lab will cover:

1. [Binomial Distributions](#binomial)
1. [The panes of RStudio](#rstudio)
1. [How to create and use R Markdown Documents](#rmarkdown)
1. [Arithmetic commands](#ac)

***

# Binomial and Multinomial Distributions {#binomial}

Binomial - for example, flipping a coin 100 times

```{r, echo = FALSE}
# set seed
set.seed(2)

# flip first coin
data_binom <- data.frame(event  = 1,
                         flip   = 1, 
                         result = rbinom(1, 1, 1/2))


# flip 99 other coins and repeat the data frame each time
for (i in 2:100) {
  data_binom <- rbind(data_binom,
                        data.frame(event  = rep(i, i),
                                   flip   = 1:i, 
                                   result = c(subset(data_binom, 
                                                     event == i - 1)$result,
                                              rbinom(1, 1, 1/2))))
}

# plot and animate the results of the flips 
data_binom %>%
  mutate(result = if_else(result == 1, "Heads", "Tails")) %>%
  ggplot(aes(x = result, fill = result)) +
    geom_bar(width = .5, alpha = .8) +
    scale_fill_manual(values = c("turquoise3",
                                 "darkorchid4")) +
    transition_reveal(event) +
    theme_bw(base_size = 15) +
    theme(legend.position = "none") +
    labs(y = "Count",
         x = "",
         caption = "Number of flips {frame_along}")

```

```{r}
# set seed
set.seed(2)

# create probability curve
data_binom <- data.frame(flip = seq(1, 100, 1),
                         prob = dbinom(x, 100, 1/2))

# plot probability curve
ggplot(data_binom, aes(x = flip, y = prob)) +
  geom_line(size   = 1.5, 
            colour = "turquoise3",
            alpha  = .8) +
  labs(x       = "Number of Heads",
       y       = "Probability") +
  theme_bw(base_size = 15) 
```

```{r}
# set seed
set.seed(2)

# create data
data_binom <- data.frame(flips = seq(1, 1000, 1), 
                         prop  = map_dbl(seq(1, 1000, 1), 
                                         ~mean(rbinom(n    = .x, 
                                                      size = 1, 
                                                      prob = 1/2))))

# plot proportion of heads by number of flips
ggplot(data_binom, aes(x = flips, y = prop, colour = prop)) +
  geom_line(size = 1) +
  labs(x = "Number of Flips",
       y = "Proportion of Heads") +
  scale_colour_gradient2(low      = "turquoise3", 
                         mid      = "turquoise",
                         high     = "turquoise3", 
                         midpoint = 0.5) +
  scale_y_continuous(limits = c(0, 1)) +
  theme_bw(base_size = 15) +
  theme(legend.position = "none")

```

## rbinom

If we want to randomely sample trials from a binomial distribution, we can use the `rbinom()` function. The function takes three arguments: (1) `n`: the number of event, (2) `size`: the number of events associated with each observation, and (3) `prob`: the probability of success on a given trial.

For example, if we wanted to flip `2` coins `10` times, we would use `rbinom(n = 10, size = 2, .5)`.

```{r, include = FALSE}
set.seed(3)
```

```{r}
rbinom(n = 10, size = 2, prob = .5)
```

From the results, we can see we got `0` heads on the first toss of our two coins, `2` heads on the second toss our two coins, and `1` head on the third toss of our two coins.

*How would we change this if we were flipping `3` coins `10` times?*

```{r}
rbinom(n = 10, size = 3, prob = .5)
```

*What about rolling `5` `6`-sided die `10` times?*

```{r}
rbinom(n = 10, size = 5, prob = 1/6)
```

*What about pulling an Ace out of `1` deck of cards `100` times?*

```{r}
rbinom(n = 100, size = 1, prob = 1/13)
```

<!--Which should be about 7.69% of the time mean(rbinom(n = 100, size = 1, prob = 1/13))-->

## dbinom

The function `dbinom` gives us the probability of getting any one result. It takes four arguments, but we will only concern ourselves with the first three: (1) `x` - a value, (2) `size` - the number of events, and (3) `prob` - the probability of success on a given event. 

To get the probability of getting `1` head by flipping `1` coin, we could run the following code.

```{r}
dbinom(x = 1, size = 1, prob = .50)
```

As you might expect, especially considering we set the probability at .50, there is a 50% probability of getting a head when you flip one coin.

**What about the probability of getting `1` head when you flip `2` coins?**

```{r}
# HT
.5 * .5

# TH
.5 * .5

dbinom(x = 1, size = 2, prob = .5)
```

**What about the probability of getting `1` head when you flip `3` coins?**

```{r}
# HTT
.5 * .5 * .5

# THT
.5 * .5 * .5

# TTH
.5 * .5 * .5

dbinom(x = 1, size = 3, prob = .5)
```

**The probability of getting `2` heads when you flip `2` coins?**
```{r}
dbinom(x = 2, size = 2, prob = .5)
```

**What's the probability of drawing `2` Aces out of a deck of cards (with replacement)?**
```{r}
# AA
(1 / 13) * (1 / 13)

dbinom(x = 2, size = 2, prob = 1/13)
```

**What's the probability of drawing anything but `2` Aces out of a deck of cards (with replacement)?**
```{r}
# OO
(12 / 13) * (12 / 13)

dbinom(x = 2, size = 2, prob = 12/13)
```

## pbinom

If we want to calculate the cumulative probability of getting a certain result, or the probability of getting a result equal to or less than what we expect, we would use the function `pbinom()`. This may not sound too important, but it is when you think about a p-value being the probability of getting a result equal to or more extreme than that observed in the sample. The function `pbinom()` takes essentially the same arguments as `dbinom()`, but instead using `x` for result of interest, we use `q`.

Returning to the example from above, if weanted to get the probability of getting `1` or less heads when we flip two coins, we would write `pbinom(q = 1, size = 2, prob = 1/2)`.

```{r}
pbinom(q = 1, size = 2, prob = 1/2)
```

The result is `.75` because there is a `.50` probability of getting `1` head and a `.25` chance of getting `0` heads. We can check this explicitely.

```{r}
# HT
.5 * .5

# TH
.5 * .5

# TT
.5 * .5
```

We can repeat this example with three coins.

```{r}
pbinom(q = 1, size = 3, prob = 1/2)
```

The result if `.50` because there was a `0.125` probability of getting `HTT`, a `0.125` probability of getting `THT`, a `0.125` probability of getting `TTH`, and a `0.125` probability of getting `TTT`. 

The function `pbinom()` also takes the argument `lower.tail`, which defaults to `TRUE`. The argument `lower.tail` is what specifies what side of the probability distribution we should be testing from. In practical terms, it is what decided that we wanted `1 or less` heads rather than `greather than 1` heads.

If we wanted to test the probability of getting `greater than 1` heads when flipping two coins, we would simple specify that `lower.tail = FALSE`.

```{r}
pbinom(q = 1, size = 2, prob = 1/2, lower.tail = FALSE)
```

*What's the probability of getting `1 or less` `6`s when  rolling `1` dice?*

```{r}
pbinom(q = 1, size = 1, prob = 1/6)
```

*What's the probability of getting `greater than 3` `6`s when  rolling `9` dice?*

```{r}
pbinom(q = 3, size = 9, prob = 1/6, lower.tail = FALSE)
```

## qbinom

The function `qbinom()` is essentially the counter of `pbinom`. Instead of taking a value and returning a probability of getting that value or less, it takes a probability and returns the value (or a value less than that value) needed to achieve the probability.

For instance if you wanted the value for which there is `100`% probability of getting that value or less on `10` coin flips, you  would write `qbinom(p = 1.00, size = 10, prob = 1/2)`.

```{r}
qbinom(p = 1.00, size = 10, prob = 1/2)
```

Unsurprisingly, the value (and the values less than a value) that has a 100% chance of occuring is `10` on `10` flips.  

*What is the minimum value that has a 75% probability of occuring with 100 coin flips?*
```{r}
qbinom(p = .75, size = 100, prob = 1/2)
```

*What is the minimum value that has a 50% probability of occuring with 100 coin flips?*
```{r}
qbinom(p = .50, size = 100, prob = 1/2)
```

*What is the minimum value that has a 25% probability of occuring with 100 coin flips?*
```{r}
qbinom(p = .25, size = 100, prob = 1/2)
```

*What is the minimum value that has a 25% probability of occuring with 100 coin flips?*
```{r}
qbinom(p = .25, size = 100, prob = 1/2, lower.tail = FALSE)
```

# Normal Distributions

## rnorm (most popular)

Drawn 10 values from a normal distribution with a mean of 0 and an sd of 1
```{r}
rnorm(10, mean = 0, sd = 1)

hist(rnorm(10, mean = 0, sd = 1))
hist(rnorm(1000, mean = 0, sd = 1))

```

```{r}
set.seed(2)
samples <- c(1, 5, 10, 15, 25, 50, 100, 250, 500, 750, 1000, 10000)

sim <- map_df(samples, ~data_frame(sample_size = rep(.x, .x), sample = rnorm(.x, mean = 0, sd = 1)))

plot3 <- ggplot(sim, aes(x = sample)) +
  geom_histogram(fill = "turquoise3", colour = "white", alpha = .7) +
  theme_bw(base_size = 16) +
  labs(x        = "x",
       y        = "Frequency",
       title    = "Sample Histogram",
       subtitle = "Sample Size: {closest_state}") + 
  scale_x_continuous(limits = c(-4, 4))  + 
  transition_states(sample_size, state_length = 2, wrap = FALSE) +
  view_follow(fixed_x = TRUE)

animate(plot3, nframes = 180, fps = 12)
```

```{r}
mean(rnorm(1000, mean = 0, sd = 1))

mean(rnorm(1000, mean = 10, sd = 1))

sd(rnorm(1000, mean = 0, sd = 1))

sd(rnorm(1000, mean = 0, sd = 10))
```

## pnorm
```{r}
x <- seq(-4, 4, 0.001)
likelihood <- dnorm(x, 0, 1)
sim <- data.frame(x, likelihood)
ggplot(sim, aes(x, likelihood)) +
    stat_function(fun = dnorm, 
                xlim = c(-5,0),
                geom = "area",
                fill = "turquoise3") +
  geom_line(size = 1.2) +
  theme_bw()
```

```{r}
ball_plot <- function(q, lower.tail = TRUE){
  if (lower.tail == TRUE) {
  discretized <- data.frame(x = qnorm(ppoints(100), 0, 1)) %>% 
  mutate(include = ifelse(x <= q, "no", "yes"))
  } else {
  discretized <- data.frame(x = qnorm(ppoints(100), 0, 1)) %>% 
  mutate(include = ifelse(x >= q, "no", "yes"))
  }

ggplot(discretized, aes(x)) +
  geom_dotplot(aes(fill = include), binwidth = 0.29, alpha = .7, colour = "white") +
  geom_vline(xintercept = q, color = "firebrick", linetype = 2, size = 1.4) +
  scale_fill_manual(
    values = c("turquoise3", "gray40"),
    guide = "none") +
  theme_bw() +
  scale_y_continuous(name = "", 
                     breaks = NULL)
}
```

```{r}
ball_plot(0)
```

What's the probabiltiy of getting 0 or less when the mean is 0 and the sd = 1
```{r}
pnorm(0, mean = 0, sd = 1)
```

What's the probabiltiy of getting 1 or less when the mean is 0 and the sd = 1 (50 + half of 68)

```{r}
ball_plot(1)
```

```{r}
pnorm(1, mean = 0, sd = 1)
```

What's the probabiltiy of getting -1 or less when the mean is 0 and the sd = 1 (100 - 68 /2 )
```{r}
ball_plot(-1)
```

```{r}
pnorm(-1, mean = 0, sd = 1)
```

What's the probabiltiy of getting 2 or greater when the mean is 0 and the sd = 1 
```{r}
ball_plot(2, lower.tail = FALSE)
```

```{r}
pnorm(2, mean = 0, sd = 1, lower.tail = FALSE)
```


## qnorm 

for probability .50
```{r}
ball_plot(0)
```

```{r}
qnorm(0.5, 0, 1)
pnorm(0.2533471, 0, 1)
```

for probability .975
```{r}
ball_plot(qnorm(0.975, 0, 1))
```

```{r}
qnorm(0.975, 0, 1)
```

for probability .97 upper
```{r}
ball_plot(qnorm(0.975, 0, 1), lower.tail = FALSE)
```

```{r}
qnorm(0.975, 0, 1, lower.tail = FALSE)
```

## dnorm

```{r}
dnorm_plot <- function(value) {
  ggplot(sim, aes(x, likelihood)) +
  geom_line(size = 1.2) +
  geom_segment(x = -4, 
               xend = value, 
               y = dnorm(value, mean = 0, sd = 1),
               yend = dnorm(value, mean = 0, sd = 1), 
               color = "turquoise3", 
               linetype = 2, 
               size = 1.4) +
  geom_segment(x = value, 
               xend = value, 
               y = 0,
               yend = dnorm(value, mean = 0, sd = 1), 
               color = "turquoise3", 
               linetype = 2, 
               size = 1.4) +
  annotate(geom = "label", x = value + .8, y = dnorm(value, mean = 0, sd = 1), label = round(dnorm(value, mean = 0, sd = 1), 3), colour = "turquoise3", size = 5) +
  geom_point(aes(x = value, y = dnorm(value, mean = 0, sd = 1)), size = 5, colour = "turquoise3") +
  scale_x_continuous(limits = c(-4, 4)) +
  theme_bw(base_size = 16)
}
```

Probability of a zero

```{r}
dnorm_plot(0)
```

```{r}
dnorm(0, mean = 0, sd = 1)
```

Probability of a 1

```{r}
dnorm_plot(1)
```

```{r}
dnorm(1, mean = 0, sd = 1)
```


Probability of -2

```{r}
dnorm_plot(-2)
```

```{r}
dnorm(-2, mean = 0, sd = 1)
```

***

# Minihacks {#minihacks}

Now that we have covered the lab material, we will move on to the Minihacks. You are welcome to work with a partner or in a small group of 2-3 people. If you have any questions, I would be happy to answer them!

## Minihack 1: Binomial Distributions

1. You are playing Dungeons and Dragons and your Dungeon master instutued

## Minihack 2: Normal Distributions

## Minihack 3: Other Distributions

1. My collaborater wants me to calculate a p-value for her, but I've sworn off null hypothesis testing. Fortunately, I was in the middle of writing this lab when I received her email. Use the `pchisq()` function to calculate the p-value for her Chi-Square test. She told me the following information about the test:
the chi-square value (`q`) was `1.00` 
there were `10` degrees of freedom (`df`)

```{r}
pchisq(3, 10, lower.tail = FALSE)
```


1. My collaborator just emailed me back and told me that she wasn't trying to calculate a p-value for a chi-square-test. She was trying to calculate a p-value for a t-test. I told her that I don't know any functions for t-tests, but she told me to Google it. Google (or take an educated guess) at how to calculate a p-value for my collaborator

```{r}
pt(3, 10, lower.tail = FALSE)
```

1. My collaborator also likes to mess with me and sometimes switches around letters in my code. The following code is calculating the cumulative probability of getting a value of `5` from a uniform distribution, but I want it to get the specific probability of getting a value of `5` from a uniform distribution. 

```{r}
dunif(x = 5, min = 0, max = 10)
```


