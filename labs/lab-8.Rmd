---
title: "Lab 8: One-sample and Independent Samples t-tests"
output: 
  html_document: 
    theme: cosmo
    toc: yes
    toc_depth: 3
    toc_float: TRUE
---

```{r setup, include = FALSE}
# set chunk options
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# suppress scientific notation
options(scipen = 999)

#load required packages
library(tidyverse) # includes dplyr and ggplot2 functions
library(gganimate) # allows the creation of gifs from ggplot2
library(lsr) # includes t-test functions
library(carData) # includes the Guyer data set
library(psych) # includes the t2d function

# load data
data <- WeightLoss
```

# Purpose

Today's lab will guide you through the process of conducting a [One-Sample t-test](#one) and an [Independent Samples t-test](#independent). For each test, we will first go through the process of conducting the tests using the arithmetic and probability distributions in R. Then we will compare and contrast the functions in the `{stats}` and `{lsr}` packages. We will also discuss some functions in the `{psych}` package.  

To quickly navigate to the desired section, click one of the following links:

1. [One-Sample t-test](#one)
1. [Independent Samples t-test](#independent)
1. [Minihacks](#minihacks)

***

# The Data

Today we will be using data from Fox and Guyer's (1978) anonymity and cooperation study provided through the `{carData}` package. For see information about the dataset you can use `?Guyer`. In short, groups of four participants (Groups = 20; $N_{TOTAL}$ = 80) played 30 trials of the the prisoner's dillema game. The number of cooperative choices (`cooperation`) were counted out of 120 (i.e., 4 participants over 30 trials). The groups either made decisions publically or privately (`condition`). Groups were either comprised of all women or all men (`sex`).

Run the following code to load the data into your global environment.

```{r}
# load data 
data <- Guyer
```

***

# One-Sample t-test {#one}

Let's first imagine that we believed that people would cooperate more than 50% of the time, regardless of condition or the sex of the groups. In other words, the alternative hypothesis ($H_{1}$) is that the population mean of cooperation is not equal to `60` ($\mu ??60$). The null hypothesis ($H_{0}$) is that the population mean of cooperation is equal to 60. To test such a hypothesis, we would use a One-Sample t-test. Essentially, the one-Sample t-test is used to examine whether the mean of some group is different from some other  number.

## Using Arithmetic

The equation for t in a One-Sample t-test is:

$\frac{\bar x - \mu}{\hat \sigma / \sqrt{N}}$

Basically, we are looking at a ratio of signal ($\bar x - \mu$) to noise ($\hat \sigma / \sqrt{N}$) in our data.

To make our lives easier, we will first calculate some descriptive statistics: the mean of `cooperation` in our sample (`coop_mean`), the standard deviation of `cooperation` in our sample (`coop_sd`), and the number of unique values in `cooperation` (`coop_n`). We should also calculate the degrees of freedom for our data. In a One-Sample t-test, the degrees of freedom is equal to $N - 1$.

```{r}
# calculate descriptives
coop_mean <- mean(data$coop)
coop_sd   <- sd(data$coop)
coop_n    <- length(data$coop)

# calculate degrees of freedoom
coop_df   <- coop_n - 1
```

From here, calculating the t-value is as easy as inserting our acquired values into the equation above: 

$\frac{48.3 - 60}{14.29 / \sqrt{20}} = 15.12$

Of course, we can also calculate this in R using the following code.

```{r}
coop_t <- (coop_mean - 60) / (coop_sd / sqrt(coop_n))
```

To get the p-value, we can use the `pt()` function. The `pt()` function takes three arguments: (1) `q` or our derived t-value, (2) `df` or the degrees of freedom of our test, and `lower.tail` or whether we want to find the cumulative probability for the upper or lower part of the distribution. To calculate a two-tailed significance test using our t-value, we would run the following code:

```{r}
coop_p <- pt(q = coop_t, df = coop_df, lower.tail = TRUE) * 2
```

We get a p-value of `0.001655805`. In other words, there is a ???. The result is multipled by `2` above because we want to be able to claim significance irrespective of whether the t-value is above or below the 50% value of `60`. As mentioned by Dr. Weston, two-tailed are, by far, the most common type of significance test. With the present data, we would not have been able to claim a significant result because the effect was in the opposite of our hypothesized direction.

Let's also calculate an effect size for our statistic. Cohen's D is a very popular measure of effect size for the t-test and it tells you the size of your effect (the difference between your mean and the null hypothesis mean) in standardized units. to calculate, we just divide the difference by the standard deviation.

```{r}
coop_d <- (coop_mean - 60) / coop_sd
```

The thresholds for a small, medium, and large effect size are shown below.

COHEN TABLE HERE.

Finally, we can also che 95% confidence interval for our sample mean by running the following code:

```{r}
coop_low  <- coop_mean + ((coop_sd / sqrt(coop_n)) * qt(.025, df = coop_df))
coop_up   <- coop_mean + ((coop_sd / sqrt(coop_n)) * qt(.975, df = coop_df))
```

The equations may seem like a mess, but we are essentially taking our mean and adding the sampling error of the mean multiplied by a value to give us its value at `.025`. We do the same thing at its value of `.975`.

## The Functions

There are two useful functions for conducting a One-Sample t-test in R. The first, is called `t.test()` and it is automatically loaded as part of the `{stats}` package when your open R. To run the t-test, you provide the function the column of the data you are interested in (e.g., `x = data$cooperation`) and the null hypothesized mu you want to compare the data against (e.g., `mu = 60`). 

```{r}
t.test(x = data$cooperation, mu = 60)
```

As we can see, you are provided the mean x, the t-value, the degrees of freedom, the p-value, and the 95% confidence interval. Unfortunately, we did not get a measure of the effect size.

The second useful function for calculate One-Sample t-tests is the aptly named `oneSampleTTest` in the `{lsr}` package

```{r}
oneSampleTTest(x = data$cooperation, mu = 60)
```

It provides you all of the information that `t.test()` did, but it also includes Cohen's d. 

## Interpretation and Write-Up

A proper write-up for our One-Sample t-test would be something along the lines of:

"Mean cooperation (*M* = 48.30, *SD* = 14.29) was substantially less than 60, *t*(19) = 3.66, *p* = .002, 95% CI [41.61, 54.97]."

***

# Independent Sample's t-test {#independent}

```{r}
data_protest <- data %>%
  filter(prot2 == 1)

```

```{r}
# calculate overall values
overall_mean <- mean(data$anger)
overall_sd   <- sd(data$anger)
overall_n    <- length(data$anger)
    
# calculate group1 values
group1_mean  <- mean(data_control$anger)
group1_sd    <- sd(data_control$anger)
group1_n     <- length(data_control$anger)

# calculate group2 values
group2_mean  <- mean(data_protest$anger)
group2_sd    <- sd(data_protest$anger)
group2_n     <- length(data_protest$anger)

# calculate t-statistic
mean_diff    <- group1_mean - group2_mean
se           <- sqrt(((group1_sd^2) / group1_n) + ((group2_sd^2) / group2_n))
t_val        <- mean_diff / se

# calculate degrees of freedom
df_num   <- ((group1_sd^2 / group1_n) + (group2_sd^2 / group2_n))^2
df_den_1 <- ((group1_sd^2) / group1_n)^2 / (group1_n - 1) 
df_den_2 <- ((group2_sd^2) / group2_n)^2 / (group2_n - 1) 
df <- df_num / (group_1_temp + group_2_temp)

# calculate p value
p_val <- pt(q = abs(t_val), df = df, lower.tail = FALSE) * 2

# calculate Cohen's d
d_val <- (t_val * sqrt((1 / group1_n) + (1 / group2_n)))

# calculate confidence intervals
ci_low  <- mean_diff + (se * qt(.025, df = df))
ci_up   <- mean_diff + (se * qt(.975, df = df))

t2d(t_val, n1 = group1_n, n2 =  group2_n)

t.test(data_control$anger, data_protest$anger, var.equal = FALSE)

independentSamplesTTest(formula = anger ~ prot2, data = data, var.equal = FALSE)

```



```{r}
data_protest <- data %>%
  filter(prot2 == 1)

t <- t.test(data_control$anger, data_protest$anger, var.equal = TRUE)
t.test(data_control$anger, data_protest$anger, var.equal = FALSE)

independentSamplesTTest(formula = anger ~ prot2, data = data, var.equal = TRUE)
independentSamplesTTest(formula = anger ~ prot2, data = data, var.equal = FALSE)


```



***

# Minihacks {#minihacks}

You are welcome to work with a partner or in a small group of 2-3 people. Please feel free to ask the lab leader any questions you might have!

The minihacks all use the `movies` data set from the `{yarrr}` package.

## Minihack 1: Histograms

1. Create a histogram of domestic and international revenue combined (`revenue.all`). Is it normally distributed?

