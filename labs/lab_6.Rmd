---
title: "Lab 4: Probability Distributions"
output: 
  html_document: 
    theme: cosmo
    toc: yes
    toc_depth: 3
    toc_float: TRUE
---

```{r setup, include = FALSE}
# set chunk options
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# suppress scientific notation
options(scipen = 999)

#load required packages
library(tidyverse) # includes ggplot2
library(here) # used to streamline the creation of this document
library(rio) # for importing data
library(yarrr) # import pirates data

# convert pirates data to a tibble
pirates <- as_tibble(pirates)
```

# Purpose

The purpose of today's lab is to introduce you to visualizing data. Although R has built in plotting functions, we will be using the `ggplot2` package in todays lab. It is far more powerful than the base R plotting functions and is the basis for other packages that allow you to create interactive plots, animated plots, and 3D plots. Being part of the `tidyverse`, `ggplot2` was also designed to work well with other `tidyverse` packages (e.g., `dplyr`, `tidyr`). The content of today's labs will be split into four sections. The first section, [The Grammar of Graphics](#grammar) will provide a brief overview of how `ggplot2` plots work. The second section, [Histograms](#hist), will provide an overview of how to create a histogram and customize it. The third section, [Categorical-Continuous Graphs](#cat), will guide you through the process of creating a barchart in R. Finally, in the [Continuous-Continuous Graphs](#cont) section, we will discuss how to create plots where you have have a continuous variable both axes. As always, the lab will end with [minihacks](#minihacks) to test your knowledge.

To quickly navigate to the desired section, click one of the following links:

1. [The Grammar of Graphics](#grammar)
1. [Histograms](#hist)
1. [Categorical-Continuous Graphs](#cat)
1. [Continuous-Continous Graphs](#cont)
1. [Minihacks](#minihacks)

Today we will be using the `pirates` data set released as part of [TidyTuesday challenge](https://twitter.com/hashtag/tidytuesday?lang=en) on October 22nd, 2019. Every Tuesday, [Thomas Mock](https://thomasmock.netlify.com) releases a data set and challenges data scientists and data enthusiasts to create plots from the data using functions in the `tidyverse`. The plots are then posted to Twitter with the hashtag `#TidyTuesday`. Taking part in [TidyTuesday](https://twitter.com/hashtag/tidytuesday?lang=en) is a fantastic way to improve your plotting skills. 

Below are included some resources that you may find useful going forward:

* Claus O. Wilke's [Fundamentals of Data Visualization](https://serialmentor.com/dataviz/) 
* [The ggplot2 cheatsheet](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf) 
* [Colors in R](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf)

***

# The Grammar of Graphics {#grammar}

![](`r here("labs", "resources", "lab6", "grammar_of_graphics.png")`)

The `ggplot2` package is built around Leland Wilkinson's idea of the *Grammar of Graphics*. In its simplest form, the *Grammar of Graphics* suggests that every graph can be created from (1) a data set (e.g., `mtcars`, `world happiness`), (2) a coordinate system (e.g., a cartesian coordinate system), and (3) a set of geometric elements that represent the data (e.g., points, lines, polygons).

# Continuous by Continuous {#cont}

Below is the **data set** `pirates`.

```{r}
# the data set
pirates
```

We can then pipe (`%>%`) that **data set** to `ggplot()` to create the **canvas** of our plot.

```{r, results = FALSE}
# the data set
pirates %>%
  # the canvas
  ggplot(aes(x = height, y = weight))
```

The `aes()` function above tells `ggplot()` that we are providing it aesthetic information for the **canvas**. In this case, we are saying the **canvas** should have `height` on the x-axis and `weight` on the y-axis. Other aesthetic mappings include `colour`, `size`, and `shape`, but we will discuss those later. Below we've printed the results of the above code. 

```{r, echo = FALSE}
# the data set
pirates %>%
  # the canvas
  ggplot(aes(x = height, y = weight))
```

As we can see, a **canvas** is not that exciting without anything on it. We can add **geometric elements** to a plot by using the functions that begin with `geom_`. Let's add some points to our plot using `geom_point`. 

```{r}
# the data set
pirates %>%
  # the canvas
  ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point()
```

*Note.* Keep in mind that when we add elements to a `ggplot` object, we must use the `+` symbol instead of the pipe symbol (`%>%`).

You can add multiple **geometric elements** to a single plot. Let's also add a regression line using `geom_smooth()`.

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point() +
    geom_smooth()
```

It looks like the line is not perfectly linear. Let's change that by specifying `method = "lm` in the `geom_smooth` function. Let's also get rid of the confidence interval around the line by specifying `se = FALSE`.

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point() +
    geom_smooth(method = "lm", 
                se     = FALSE)
```

Let's also update the look of the plot. We can use `colour` (or `color`) to specify the colour of **geometric elements**. We can also use `size` to set the `size`, `alpha` to set the opacity (i.e., how transparent it is), and `shape` to set the `shape` of a **geometric element**. 

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "deeppink2", 
                size   = 1.5,
                alpha  = .7)
```

The **geometric elements** look much better, but I don't really like the look of the *canvas*. We can change the theme of the **canvas** by using the suite of functions that start with `theme_`. I like `theme_bw`, but other choices include `theme_gray`, `theme_minimal`, and `theme_classic`

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "deeppink2", 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw()
```

Finally, no plot is complete without proper labels. Fortunately, `ggplot2` has the `labs()` function built in for just this purpose. 

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "deeppink2", 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday")
```


```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "deeppink2", 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday")
```

What if we wanted to break this down by the pirates sex? Well first, let's remove the colours for simplicites sake

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point(size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday")
```

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point(size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday")
```

If we put `colour = sex` with the `aes()` function of the `geom_smooth` function, the lines will distinguish between pirates using colour. 

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight)) +
    # the geometric elements
    geom_point(aes(colour = sex),
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday")
```


The points don't seem to distinguish btween the colours. This is because the colour mapping is only mapped to geom_smooth, and not geom_point and geom_smooth. We could add `aes(colour = release_country)` to geom_smooth as well but if we add it to the step where we made the canvas, geom_point and geom_smooth will inheret. 

We can also use the `shape` aesthetic mapping, to change the shapes by country. Let's add that to geom_point().

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight, colour = sex)) +
    # the geometric elements
    geom_point(aes(shape = sex),
               size   = 3,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday")
```

Well, that looks terrible. Let's try changing the colour pallete. If we want to set our own pallette we can use scale_olour_manual`.

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight, colour = sex)) +
    # the geometric elements
    geom_point(aes(shape = sex),
               size   = 3,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday") +
    # change colour pallete
    scale_colour_manual(values = c("red", "blue", "green"))
```

I chose terrible colours. We should use a built in palette using the scale_colour_brewer function. The brewer palettes can be found here: http://www.sthda.com/english/wiki/colors-in-r 

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight, colour = sex)) +
    # the geometric elements
    geom_point(aes(shape = sex),
               size   = 3,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday") +
    # change colour pallete
    scale_colour_brewer(palette = "Set2")
```

I also really don't like that. Let's pull in the big guns. Use scale_colour_viridis_d to use colpour blind safe colours

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight, colour = sex)) +
    # the geometric elements
    geom_point(aes(shape = sex),
               size   = 3,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday") +
    # change colour pallete
    scale_colour_viridis_d()
```

Okay, that is definitely better, but it is still hard to distinguish between the three lines. We can use facet_wrap to plot the three plots side_by_side

```{r}
# the data set
pirates %>%
  # the canvas
    ggplot(aes(x = height, y = weight, colour = sex)) +
    # the geometric elements
    geom_point(aes(shape = sex),
               size   = 3,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday") +
    # change colour pallete
    scale_colour_viridis_d() +
    # facet_wrap by sex
    facet_wrap(~sex)
```

# Categorical by Continuous

Okay, but what if we want to look at categorical plot.

```{r}
# the data set
pirates %>%
  # the canvas
  ggplot(aes(x = sex, y = height)) +
    # the geometric elements
    geom_col()
```

It looks like it is adding up the run times (not taking the average run time).

```{r}
# the data set
pirates %>%
  group_by(sex) %>%
  summarise(avg_height = mean(height)) %>%
  # the canvas
  ggplot(aes(x = sex, y = avg_height)) +
    # the geometric elements
    geom_col()
```

Let's reorder from shortest to tallest.
```{r}
# the data set
pirates %>%
  group_by(sex) %>%
  summarise(avg_height = mean(height)) %>%
  # the canvas
  ggplot(aes(x = reorder(sex, avg_height), y = avg_height)) +
    # the geometric elements
    geom_col()
```

Bah, still wrong order.

```{r}
# the data set
pirates %>%
  group_by(sex) %>%
  summarise(avg_height = mean(height)) %>%
  # the canvas
  ggplot(aes(x = reorder(sex, avg_height), y = avg_height)) +
    # the geometric elements
    geom_col()
```

We can coord_flip

```{r}
# the data set
pirates %>%
  group_by(sex) %>%
  summarise(avg_height = mean(height)) %>%
  # the canvas
  ggplot(aes(x = reorder(sex, avg_height), y = avg_height)) +
    # the geometric elements
    geom_col() +
    # flip the coordinates
    coord_flip()
```

Okay, let's make the bar a certain colour

```{r}
# the data set
pirates %>%
  group_by(sex) %>%
  summarise(avg_height = mean(height)) %>%
  # the canvas
  ggplot(aes(x = reorder(sex, avg_height), y = avg_height)) +
    # the geometric elements
    geom_col(colour = "turquoise3") +
    # flip the coordinates
    coord_flip()
```

Oh not, what is going on here? When an object has both an outline and an inside, colour changes the colour of the outline. Here we should use the fill colour. 

```{r}
# the data set
pirates %>%
  group_by(sex) %>%
  summarise(avg_height = mean(height)) %>%
  # the canvas
  ggplot(aes(x = reorder(sex, avg_height), y = avg_height)) +
    # the geometric elements
    geom_col(fill = "turquoise",
             colour = "white") +
    # flip the coordinates
    coord_flip()
```

More finishing touches

```{r}
# the data set
pirates %>%
  group_by(sex) %>%
  summarise(avg_height = mean(height)) %>%
  # the canvas
  ggplot(aes(x = reorder(sex, avg_height), y = avg_height)) +
    # the geometric elements
    geom_col(fill = "turquoise",
             colour = "white",
             alpha = .7,
             width = .5) +
    # flip the coordinates
    coord_flip() +
    # set theme
    theme_bw() +
    # add labels 
    labs(title = "Average height of pirate by pirate sex",
         x     = "Sex",
         y     = "Average Height (cm)")
```

# Histograms 
```{r}
# the data set
pirates %>%
  # the canvas
  ggplot(aes(x = age)) +
    # the geometric elements
    geom_histogram(fill = "turquoise",
             colour = "white",
             alpha = .7,
             bins = 35) +
    # set theme
    theme_bw() +
    # add labels 
    labs(title = "Frequency Distributin of Pirate Ages",
         x     = "Age",
         y     = "Frequency")
```


# Minihacks {#minihacks}


