---
title: "Lab 4: Probability Distributions"
output: 
  html_document: 
    theme: cosmo
    toc: yes
    toc_depth: 3
    toc_float: TRUE
---

```{r setup, include = FALSE}
# set chunk options
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# suppress scientific notation
options(scipen = 999)
```

# Purpose

The purpose of today's lab is to introduce you to visualizing data. Although R has built in plotting functions, we will be using the `ggplot2` package in todays lab. It is far more powerful than the base R plotting functions and is the basis for other packages that allow you to create interactive plots, animated plots, and 3D plots. Being part of the `tidyverse`, `ggplot2` was also designed to work well with other `tidyverse` packages (e.g., `dplyr`, `tidyr`). The content of today's labs will be split into four sections. The first section, [The Grammar of Graphics](#grammar) will provide a brief overview of how `ggplot2` plots work. The second section, [Histograms](#hist), will provide an overview of how to create a histogram and customize it. The third section, [Categorical-Continuous Graphs](#cat), will guide you through the process of creating a barchart in R. Finally, in the [Continuous-Continuous Graphs](#cont) section, we will discuss how to create plots where you have have a continuous variable both axes.

To quickly navigate to the desired section, click one of the following links:

1. [The Grammar of Graphics](#grammar)
1. [Histograms](#hist)
1. [Categorical-Continuous Graphs](#cat)
1. [Continuous-Continous Graphs](#cont)

Below are included some documents that you may find helpful for constructing graphs:

* Claus O. Wilke's [Fundamentals of Data Visualization](https://serialmentor.com/dataviz/) 
* [The ggplot2 cheatsheet](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf) 
* [Colors in R](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf)

***

# The Grammar of Graphics

```{r}
# load required packages
library(tidyverse)
library(rio)
```

# The Data

```{r data_import}
data_horror <- import(file     = paste0("https://raw.githubusercontent.com/",
                                        "rfordatascience/",
                                        "tidytuesday/",
                                        "master/",
                                        "data/",
                                        "2019/2019-10-22/",
                                        "horror_movies.csv"),
                      setclass = "tibble")
```

```{r data_wrangle}
# wrangle the data
data_horror <- data_horror %>%
  # remove unused columns
  select(-genres, 
         -movie_rating,
         -plot:-filming_locations) %>%
  # convert move_run_time and budget into numbers; extract year from title and
  # create a release_year column
  mutate(movie_run_time = parse_number(movie_run_time),
         budget         = parse_number(budget),
         release_date   = lubridate::as_date(release_date)) %>%
  # drop incomplete cases (don't do this with your own data)
  na.omit() %>%
  # remove budget outliers ("Train to Busan (2016)" and "White God (2014)")
  filter(title != "Train to Busan (2016)",
         title != "White God (2014)") %>%
  # only retain movies from the last 10 years
  filter(release_date >= "2009-11-08") %>%
  # retain only the 5 countries that have produced the most horror movies
  filter(release_country %in% c("USA",       "UK", "Germany", "Philippines",
                                "Canada", "India",  "Russia")) 

```

# Continuous by Continuous

```{r}
ggplot(data = data_horror, aes(x = budget, y = review_rating)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) + 
  scale_x_log10()
```

```{r}
ggplot(data = data_horror, aes(x      = movie_run_time, 
                               y      = budget,
                               colour = release_country)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_y_log10()
```

```{r}
data_horror_sum <- data_horror %>%
  group_by(release_country) %>%
  summarize(review_m = mean(review_rating))


ggplot(data_horror_sum, aes(x = release_country, 
                            y = review_m)) +
    geom_col()

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col()

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(colour = "turquoise")

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(colour = "black")

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(fill = "turquoise3",
             colour = "black")

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(fill   = "turquoise3",
             colour = "black",
             alpha  = .60)

ggplot(data_horror_sum, aes(x = reorder(release_country, review_m), 
                            y = review_m)) +
    geom_col(fill   = "turquoise3",
             colour = "black",
             alpha  = .60,
             width  = .5 ) +
    coord_flip()

ggplot(data_horror_sum, aes(x = reorder(release_country, review_m), 
                            y = review_m)) +
    geom_col(fill   = "turquoise3",
             colour = "black",
             alpha  = .60,
             width  = .5 ) +
    coord_flip() +
    theme_bw() +
    labs(x = "Country",
         y = "")


```
