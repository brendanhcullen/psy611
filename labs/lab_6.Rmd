---
title: "Lab 4: Probability Distributions"
output: 
  html_document: 
    theme: cosmo
    toc: yes
    toc_depth: 3
    toc_float: TRUE
---

```{r setup, include = FALSE}
# set chunk options
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# suppress scientific notation
options(scipen = 999)

#load required packages
library(lubridate) # for parsing dates
library(tidyverse) # includes ggplot2
library(here) # used to streamline the creation of this document
library(rio) # for importing data

```

```{r load_data}
horror_movies <- import(file     = paste0("https://raw.githubusercontent.com/",
                                          "rfordatascience/",
                                          "tidytuesday/",
                                          "master/",
                                          "data/",
                                          "2019/2019-10-22/",
                                          "horror_movies.csv"),
                        setclass = "tibble") %>%
  # remove unused columns
  select(-genres, 
         -movie_rating,
         -plot:-filming_locations) %>%
  # convert move_run_time and budget into numbers; extract year from title and
  # create a release_year column
  mutate(movie_run_time = parse_number(movie_run_time),
         budget         = parse_number(budget),
         release_date   = dmy(release_date)) %>%
  # drop incomplete cases (don't do this with your own data)
  na.omit() %>%
  # remove budget outliers ("Train to Busan (2016)" and "MSG the Warrior: Lion 
  #Heart (2016)")
  filter(title != "Train to Busan (2016)",
         title != "MSG the Warrior: Lion Heart (2016)") %>%
  # only retain movies from the last 10 years
  filter(release_date >= "2009-11-08") %>%
  # retain only the 5 countries that have produced the most horror movies
  filter(release_country %in% c("USA",       "UK", "Germany", "Philippines",
                                "Canada", "India",  "Russia")) 
```

# Purpose

The purpose of today's lab is to introduce you to visualizing data. Although R has built in plotting functions, we will be using the `ggplot2` package in todays lab. It is far more powerful than the base R plotting functions and is the basis for other packages that allow you to create interactive plots, animated plots, and 3D plots. Being part of the `tidyverse`, `ggplot2` was also designed to work well with other `tidyverse` packages (e.g., `dplyr`, `tidyr`). The content of today's labs will be split into four sections. The first section, [The Grammar of Graphics](#grammar) will provide a brief overview of how `ggplot2` plots work. The second section, [Histograms](#hist), will provide an overview of how to create a histogram and customize it. The third section, [Categorical-Continuous Graphs](#cat), will guide you through the process of creating a barchart in R. Finally, in the [Continuous-Continuous Graphs](#cont) section, we will discuss how to create plots where you have have a continuous variable both axes. As always, the lab will end with [minihacks](#minihacks) to test your knowledge.

To quickly navigate to the desired section, click one of the following links:

1. [The Grammar of Graphics](#grammar)
1. [Histograms](#hist)
1. [Categorical-Continuous Graphs](#cat)
1. [Continuous-Continous Graphs](#cont)
1. [Minihacks](#minihacks)

Today we will be using the `horror_movies` data set released as part of [TidyTuesday challenge](https://twitter.com/hashtag/tidytuesday?lang=en) on October 22nd, 2019. Every Tuesday, [Thomas Mock](https://thomasmock.netlify.com) releases a data set and challenges data scientists and data enthusiasts to create plots from the data using functions in the `tidyverse`. The plots are then posted to Twitter with the hashtag `#TidyTuesday`. Taking part in [TidyTuesday](https://twitter.com/hashtag/tidytuesday?lang=en) is a fantastic way to improve your plotting skills. 

Below are included some resources that you may find useful going forward:

* Claus O. Wilke's [Fundamentals of Data Visualization](https://serialmentor.com/dataviz/) 
* [The ggplot2 cheatsheet](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf) 
* [Colors in R](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf)

***

# The Grammar of Graphics {#grammar}

![](`r here("labs", "resources", "lab6", "grammar_of_graphics.png")`)

The `ggplot2` package is built around Leland Wilkinson's idea of the *Grammar of Graphics*. In its simplest form, the *Grammar of Graphics* suggests that every graph can be created from (1) a data set (e.g., `mtcars`, `world happiness`), (2) a coordinate system (e.g., a cartesian coordinate system), and (3) a set of geometric elements that represent the data (e.g., points, lines, polygons).

# Continuous by Continuous {#cont}

Below is the **data set** `horror_movies`.

```{r}
# the data set
horror_movies
```

We can then pipe (`%>%`) that **data set** to `ggplot()` to create the **canvas** of our plot.

```{r, results = FALSE}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating))
```

The `aes()` function above tells `ggplot()` that we are providing it aesthetic information for the **canvas**. In this case, we are saying the **canvas** should have `budget` on the x-axis and `review_rating` on the y-axis. Other aesthetic mappings include `colour`, `size`, and `shape`, but we will discuss those later. Below we've printed the results of the above code. 

```{r, echo = FALSE}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating))
```

As we can see, a **canvas** is not that exciting without anything on it. We can add **geometric elements** to a plot by using the functions that begin with `geom_`. Let's add some points to our plot using `geom_point`. 

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating)) +
    # the geometric elements
    geom_point()
```

*Note.* Keep in mind that when we add elements to a `ggplot` object, we must use the `+` symbol instead of the pipe symbol (`%>%`).

You can add multiple **geometric elements** to a single plot. Let's also add a regression line using `geom_smooth()`.

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating)) +
    # the geometric elements
    geom_point() +
    geom_smooth()
```

It looks like the line is not linear. Let's change that by specifying `method = "lm` in the `geom_smooth` function. Let's also get rid of the confidence interval around the line by specifying `se = FALSE`.

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating)) +
    # the geometric elements
    geom_point() +
    geom_smooth(method = "lm", 
                se     = FALSE)
```

Let's also update the look of the plot. We can use `colour` (or `color`) to specify the colour of **geometric elements**. We can also use `size` to set the `size`, `alpha` to set the opacity (i.e., how transparent it is), and `shape` to set the `shape` of a **geometric element**. 

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "darkorchid", 
                size   = 1.5,
                alpha  = .7)
```

The **geometric elements** look much better, but I don't really like the look of the *canvas*. We can change the theme of the **canvas** by using the suite of functions that start with `theme_`. I like `theme_bw`, but other choices include `theme_gray`, `theme_minimal`, and `theme_classic`

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "darkorchid", 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw()
```

You may have also noticed that our budget day looks very positively skewed. We can change the scale of the x-axis to a log scale by using the `scale_x_log10` function.

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "darkorchid", 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # scale x-axis
    scale_x_log10()
```

Finally, no plot is complete without proper labels. Fortunately, `ggplot2` has the `labs()` function built in for just this purpose. 

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = budget, y = review_rating)) +
    # the geometric elements
    geom_point(colour = "turquoise3",
               size   = 5,
               shape  = 18,
               alpha  = .5) +
    geom_smooth(method = "lm", 
                se     = FALSE, 
                colour = "darkorchid", 
                size   = 1.5,
                alpha  = .7) +
    # the theme
    theme_bw() +
    # scale x-axis
    scale_x_log10() +
    # add labels
    labs(title    = "Scatterplot of Horror Movie Budgets and Rating",
         subtitle = "A ggplot plots",
         x        = "Budget (log)",
         y        = "Review Rating",
         caption  = "Created using the Horror Movie data set from TidyTuesday")
```

# Continuous by Continuous by Categorical {#cct}

Let's create a plot looking at the relationship between `release_date` and `movie_run_time`.

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_date, y = movie_run_time)) +
    # the geometric elements
    geom_point() +
    geom_smooth(method = "lm",
                se     = FALSE) +
    # the theme
    theme_bw()
```

We don't see a relationship here, but maybe there is if we look within country. If we put `colour = release_country` with the `aes()` function of the `geom_smooth` function, the lines will distinguish between countries using colour. 

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_date, y = movie_run_time)) +
    # the geometric elements
    geom_point() +
    geom_smooth(aes(colour = release_country),
                method = "lm",
                se     = FALSE) +
    # the theme
    theme_bw()
```

The points don't seem to distinguish btween the colours. This is because the colour mapping is only mapped to geom_smooth, and not geom_point and geom_smooth. We could add `aes(colour = release_country)` to geom_smooth as well but if we add it to the step where we made the canvas, geom_point and geom_smooth will inheret. 

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_date, y = movie_run_time, colour = release_country)) +
    # the geometric elements
    geom_point() +
    geom_smooth(method = "lm",
                se     = FALSE) +
    # the theme
    theme_bw()
```

We can also use the `shape` aesthetic mapping, to change the shapes by country. Let's add that to geom_point(). 

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_date, y = movie_run_time, colour = release_country)) +
    # the geometric elements
    geom_point(aes(shape = release_country)) +
    geom_smooth(method = "lm",
                se     = FALSE) +
    # the theme
    theme_bw()
```

Well, that looks terrible. Let's try changing the colour pallete. If we want to set our own pallette we can use scale_olour_manual`.

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_date, y = movie_run_time, colour = release_country)) +
    # the geometric elements
    geom_point(aes(shape = release_country)) +
    geom_smooth(method = "lm",
                se     = FALSE) +
    # the theme
    theme_bw() +
    # change colour pallete
    scale_colour_manual(values = c("red", "blue", "green", "yellow", 
                                   "purple", "pink", "black"))
```

I chose terrible colours. We should use a built in palette using the scale_colour_brewer function. The brewer palettes can be found here: http://www.sthda.com/english/wiki/colors-in-r 

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_date, y = movie_run_time, colour = release_country)) +
    # the geometric elements
    geom_point(aes(shape = release_country)) +
    geom_smooth(method = "lm",
                se     = FALSE) +
    # the theme
    theme_bw() +
    # change colour pallete
    scale_colour_brewer(palette = "Set1")
```

I also really don't like that. Let's pull in the big guns. Use scale_colour_viridis_d to use colpour blind safe colours

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_date, y = movie_run_time, colour = release_country)) +
    # the geometric elements
    geom_point(aes(shape = release_country)) +
    geom_smooth(method = "lm",
                se     = FALSE) +
    # the theme
    theme_bw() +
    # change colour pallete
    scale_colour_viridis_d()
```

# Categorical by Continuous

Okay, but what if we want to look at categorical plot.

```{r}
# the data set
horror_movies %>%
  # the canvas
  ggplot(aes(x = release_country, y = movie_run_time)) +
    # the geometric elements
    geom_col()
```

It looks like it is adding up the run times (not taking the average run time).

```{r}
# the data set
horror_movies %>%
  group_by(release_country) %>%
  summarise(avg_budget = mean(budget)) %>%
  # the canvas
  ggplot(aes(x = release_country, y = avg_budget)) +
    # the geometric elements
    geom_col()
```

Wrong order. Let's reorder.
```{r}
# the data set
horror_movies %>%
  group_by(release_country) %>%
  summarise(avg_budget = mean(budget)) %>%
  # the canvas
  ggplot(aes(x = reorder(release_country, avg_budget), y = avg_budget)) +
    # the geometric elements
    geom_col()
```
Still, wrong order.

```{r}
# the data set
horror_movies %>%
  group_by(release_country) %>%
  summarise(avg_budget = mean(budget)) %>%
  # the canvas
  ggplot(aes(x = reorder(release_country, -avg_budget), y = avg_budget)) +
    # the geometric elements
    geom_col()
```



# Continuous by Continuous

```{r}
ggplot(data = horror_movies, aes(x = budget, y = review_rating)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

```{r}
ggplot(data = data_horror, aes(x      = budget, 
                               y      = movie_run_time,
                               colour = release_country)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

```{r}
data_horror_sum <- data_horror %>%
  group_by(release_country) %>%
  summarize(review_m = mean(review_rating))


ggplot(data_horror_sum, aes(x = release_country, 
                            y = review_m)) +
    geom_col()

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col()

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(colour = "turquoise")

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(colour = "black")

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(fill = "turquoise3",
             colour = "black")

ggplot(data_horror_sum, aes(x = reorder(release_country, -review_m), 
                            y = review_m)) +
    geom_col(fill   = "turquoise3",
             colour = "black",
             alpha  = .60)

ggplot(data_horror_sum, aes(x = reorder(release_country, review_m), 
                            y = review_m)) +
    geom_col(fill   = "turquoise3",
             colour = "black",
             alpha  = .60,
             width  = .5 ) +
    coord_flip()

ggplot(data_horror_sum, aes(x = reorder(release_country, review_m), 
                            y = review_m)) +
    geom_col(fill   = "turquoise3",
             colour = "black",
             alpha  = .60,
             width  = .5 ) +
    coord_flip() +
    theme_bw() +
    labs(x = "Country",
         y = "")


```

# Minihacks {#minihacks}


